

# DEFINING THE QUESTION

# Specific Data Analytics Question

Performing Customer segmentation by analyzing the basic data about customers of supermarket XYZ and developing a model that groups them into non-overlapping sub-groups that are distinct from each other.

# Metrics for Success

Building a model with Clusters that are accurately distinct. 

# Understanding the Context

Customer segmentation is the process by which customers are divided  based on common characteristics so that products can be marketed to the customers more effectively. These characteristics can be based on [Demographics](https://www.voxco.com/blog/what-is-demographic-segmentation/#:~:text=Demographic%20segmentation%20is%20a%20market,can%20be%20addressed%20more%20effectively) or [Behavior](https://www.yieldify.com/blog/behavioral-segmentation-definition-examples/#:~:text=Behavioral%20segmentation%20refers%20to%20a,a%20particular%20business%20or%20website). Customer segmentation is popular because it helps a firm market and sell more effectively as they are able to develop a better understanding of their customers’ needs and desires. The business impact of doing this is even more important as it increases Customer lifetime value and drives greater customer loyalty.

While traditional mass marketing techniques work and are still effective, it is inefficient and costly compared to targeted advertisements where one can correctly identify their customers. In simple terms, if customers can be accurately clustered, customized advertisements and offers to increase engagements can be created. In addition, new market opportunities for products/services can be explored to complement existing ones.


# Experimental Design.

1.Data Preparation

 -  Loading the dataset
 
 -  Data Uniformity
 
 -  Checking for Missing/Duplicate Values
 
 -  Checking Outliers
 
2.Exploratory Data Analysis

 -  Univariate Analysis
  
 -  Bivariate Analysis
 
3.Clustering
 
4.Conclusions and Recommendations


# Data Relevance

 - Customer ID ~ Unique customer ID number
 
 - Gender ~ Gender of the customer (Male or Female)
 
 - Age ~ Age of the Customer in Years
 
 - Annual Income ~ Income of the customers in thousands (K$)
 
 - Spending Score ~ Spending score of the customer from a scale of 1-100


# 1. Data Preparation

Loading Libraries
``` {r}
#Loading dependencies: 
library(readxl)
library(tidyverse)
library(scales)
library(psych)
library(mlr)
library(grid)
library(ggplot2)
library(gridExtra)
library(crosstable)
library(GGally)
library(caret)

#For visualization:
library(ggcorrplot)


#For copying the data:
library(data.table)

#For Label Encoding
library(superml)

#For Clustering:
library(factoextra)
library("ggdendro")
library(flashClust)
library(NbClust)
library(cluster)
library(purrr)
```


Loading the Dataset
```{r}
#Importing the data to the Global Environment:
Demographics <- read_excel("C:/Users/Elijah/Desktop/Customer Demographics.xlsx")

#Printing the first 4 rows of the dataframe
head(Demographics, n=4)

```

```{r}
#Checking the Number of Rows and Columns:
dim(Demographics)

```


Data Uniformity
```{r}
#Getting Information on the data types on each respective column:
sapply(Demographics, class)

```
```{r}
#Renaming the column names for ease of reference:
names(Demographics) <- c('CustomerID', 'Gender', 'Age', 'AnnualIncome', 'SpendingScore')

```


```{r}
#Viewing the full information:
str(Demographics)

```
 - The Dataset is made up of 200 Rows and 5 Columns
 
 - The datatypes in the data are as follows:
 
   -  Continuous: Customer ID, Age, Annual Income and Spending Score
   
   -  Character: Gender
   

Missing Values
```{r}
#Checking for null entries in each column:
colSums(is.na(Demographics))

```


Duplicate values
```{r}
#Checking for identical entries:
sum(duplicated(Demographics))


```

The data has no missing or duplicate values.


Checking for Outliers
```{r}
#Using a Box plot to check for outliers on the numerical variables:
qplot( x =  Age, y = "", geom = "boxplot", data = Demographics, col = I("darkolivegreen4"), fill = I("cyan3"), main = "Age ")
qplot( x =  AnnualIncome,  y = "", geom = "boxplot", data = Demographics, col = I("darkolivegreen4"), fill = I("cyan3"), main = "Annual Income (K$)")
qplot( x =  SpendingScore, y = "", geom = "boxplot", data = Demographics ,col = I("darkolivegreen4"), fill = I("cyan3"), main = "Spending Score (1-100)")


```

An outlier can be observed on Annual Income. Since there's no basis to assume the entry is not valid, the outlier is not dropped.



# 2. Exploratory Data Analysis

This process involves investigating the dataset to discover patterns.

# Univariate Analysis

This analysis aims to explore each demographic variable in the dataset separately

 - Gender Distribution

```{r}
#To view the distribution of Gender:
Gen_table <- table(Demographics$Gender)

#Plotting the Information above:
x <- c(56, 44)
labels <- c('Females', 'Males')
colors <- c('cyan3','cyan4')
#pie_percent<- round(100*x/sum(x), 0) 
pie(x, labels = percent(x/100), main=' Gender Distribution', density=30, col=colors)
legend("topright", c("Females", "Males"), cex = 0.9, fill = colors)

```

Of the 200 sampled customers, 112 were Females while 88 were Males.


 - Age Distribution
 
```{r}
#To view the Age distribution of the customers:
Age_table <- table(Demographics$Age)

#Plotting the Information above:
ggplot(data = Demographics, mapping = aes(x = Age)) + 
  geom_histogram(fill = "cyan3", color = "black", binwidth = 2) + labs(x = "Age (Year's)", title = "Age Distribution")
                                                                               

```

The Age of the customers range from 18-70 years.

Those frequently visiting the supermarket are of the young and adult age groups (27-45)

Less frequent visitors are those aged 55 and above.

The distribution is close to a normal distribution.


 - Income Levels
 
```{r}
#To view the Income distribution of the customers:
Income_table <- table(Demographics$AnnualIncome)

#Plotting the Information above:
ggplot(data = Demographics, mapping = aes(x = AnnualIncome)) + 
  geom_histogram(fill = "cyan3", color = "black", binwidth = 10) + labs(x = "Income (K$)", title = "Income Levels")
                
```

The Income levels of the customers range from $15k - 137k.

People earning an average income of 70k$ have the highest frequency count.

The average annual income of the customers is 60.56k$.


 - Spending Score
 
```{r}
#To view the Spending Score of the customers:
Spending_table <- table(Demographics$SpendingScore)

#Plotting the Information above:
ggplot(data = Demographics, mapping = aes(x = SpendingScore)) + 
  geom_histogram(fill = "cyan3", color = "black", binwidth = 10) + labs(x = "Spending Score (1-100)", title = "Spending Scores")

```

[Spending Score](https://www.predicagroup.com/blog/customer-scoring-segmentation/) is a score given to a customer by the Supermarket authorities based on the money spent and the behavior of the customer.

This is an Important Chart as it gives an idea about the Spending rate of the Customers Visiting the Supermarket.

From the plot, most of the customers have a score in the range of 40 - 60.

There are customers also having a score of 99 showing that the Supermarket caters for the variety of customers with varying needs and requirements.


```{r}
#Printing the Descriptive Summary:
summary(Demographics)

```


# Bivariate Analysis
 
This analysis involves two variables being observed against each other.

 - Correlation Matrix

```{r}
#Creating a dataframe Cr:
Cr<- Demographics

#Visualizing the Plot:
corr_map <- ggcorr(Cr[,3:5], method=c("everything", "pearson"), label=TRUE, hjust = .90, size = 3, layout.exp = 2)
corr_map


```

Age is Negatively correlated with Spending Score.

No correlation exists between Annual Income and Age, Spending Score and Annual Income


The analysis seeks to further answer:


 - Does Income Levels affect Spending Scores

```{r}
#To see the relationship between Income and Spending scores across the different genders:
ggplot(Demographics, aes(x=AnnualIncome, y = SpendingScore )) + geom_point(aes(colour= `Gender`))+labs(title='Relationship Between Income and Spending Score')

```

Roughly, Annual income of $40–70k corresponds to a 40–60 spending score.

There seem to be a cluster-like pattern when looking at income and spending score: High Income Individuals with High Income spending, High Income Individuals with Low Spending Score.
 
There doesn't seem to be any difference in spending score when comparing the gender of a customer.
 
 - Does Age influence Spending Scores
 
```{r}
#To see the relationship between Age and Spending scores across the different genders:
ggplot(Demographics, aes(x=Age, y = SpendingScore )) + geom_point(aes(colour= `Gender`))+labs(title='Relationship between Age and Spending Score')

```

The lower the age higher the spending score.

Customers in the age range of 15-40 years old make up most the the customers with a spending score of above 60
 
Customers above 40 years old does not seem to have a spending score of above 60. This can be justified with the fact that they make a small number of the entire sample.


 - Does Age influence Annual Income
 
```{r}
#To see the relationship between Age and Annual Income across the different genders:
ggplot(Demographics, aes(x=Age, y = AnnualIncome )) + geom_point(aes(colour= `Gender`))+labs(title='Relationship between Age and Annual Income')

```

Income Levels are high among customers aged 30-50 years.



# K-Means Clustering

This algorithm aims to partition observations into clusters based on Feature similarity.

```{r}
#Creating the modelling dataframe:
Model <- select(Demographics , 'Age', 'Age', 'AnnualIncome', 'SpendingScore')

#Viewing the Data types:
sapply(Model, class)

```

# Feature Engineering

1. Feature Scaling

```{r}
#Transforming the ranges to the same scale of 0 to 1 using Min Max:
#Model <- as.data.frame(sapply(Model, function(x) (x-min(x))/(max(x)-min(x))))

```

# Model Training

- Determining Optimal Clusters

Determining the Best K using the 3 popular methods:

1. Elbow Method

```{r}
#Using the Elbow method to find the optimal k:
set.seed(123)

#Function to calculate total intra-cluster sum of square: 
iss <- function(k) {
  kmeans(Model,k,iter.max=100,nstart=100,algorithm="Lloyd" )$tot.withinss
}
k.values <- 1:10
iss_values <- map_dbl(k.values, iss)
plot(k.values, iss_values,
    type="b", pch = 19, frame = FALSE, 
    xlab="Number of clusters K",
    ylab="Total intra-clusters sum of squares")


```

From the above graph, we conclude that 4 is the appropriate number of clusters since it seems to be appearing at the bend in the elbow plot.


2.Gap statistic

```{r}
# Finding the optimal number of clusters using the Gap Statistic method:
set.seed(123)
stat_gap <- clusGap(Model, FUN = kmeans, nstart = 25,
            K.max = 10, B = 50)
fviz_gap_stat(stat_gap)
```


3.Silhouette method

```{r}
#Finding the optimal number of clusters using the Silhouette method:
fviz_nbclust(Model, kmeans, method = "silhouette")

```


From the Methods above, the best K is 6

```{r}
# Plotting the K_Mean Clusters with the Optimal K:
New_Model = kmeans(Model,6,iter.max=100,nstart=50,algorithm="Lloyd")
New_Model

```


```{r}
#Looking at the Important components using PCA:
pcclust=prcomp(Model,scale=FALSE) 
summary(pcclust)
pcclust$rotation[,1:2]

```
The first two components explain 89% of the Total variation in the data set.


# Interpreting the Clusters

To get a more comprehensible understanding of the predicted clusters:

- Clustering customers based on Annual Income and Spending score

```{r}
#To view the clustering:
set.seed(1)
ggplot(Model, aes(x =AnnualIncome, y = SpendingScore)) + 
  geom_point(stat = "identity", aes(color = as.factor(New_Model$cluster))) +
  scale_color_discrete(name=" ",
              breaks=c("1", "2", "3", "4", "5","6"),
              labels=c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5","Cluster 6")) +
  ggtitle("Segments of Supermarket Customers", subtitle = "Annual Income and Spending Score")


```

Cluster 2: 

 - This Cluster represents customers with low annual income and  low spending score.

 - This is quite reasonable as people having low salaries prefer to buy less. 
 
 - The Supermarket would be least interested in people belonging to this cluster.
 
 
Cluster 3: 

- This Cluster represents customers with high annual income and low spending score

- This might be those unsatisfied with the products/services being offered. These can be the prime targets as they have the potential to spend money. The Supermarket can look into adding new facilities that can attract these people and meet their needs

Cluster 1 and 5: 

 - This clusters represents customers with average annual income and average spending scores.
 


Cluster 4: 

 - This cluster represents customers with high annual income and high spending score.
 
 - This is the ideal case as this group forms the prime sources of profit.These are the regular customers who are satisfied with the products/services 


Cluster 6:

 - This cluster represents customers with low annual income but high spending score.

 - These are those people who for some reason love to buy products more often even though they have a low income. 
 
 - The supermarket might not target these people that effectively but still will not want to lose them.
 

# Conclusions


 - To increase profits, the store should target people belonging to cluster 3, 1 and 5.
 
 - The store should work towards maintain its standards to keep the customers belonging to cluster 4 and cluster 6 happy and satisfied.

# Recommendations

 - For those with high spending scores: These customers may potentially be impulsive buyers (cluster 6 and 4) that purchase based on what looks fresh or special discounts. Management could consider having daily/weekly sale items or limited-time new items for sale to keep these customers excited and coming back.

 - For those with lower spending scores: These customers may potentially be discount/value buyers (clusters 2 and 3) that purchase based on prices and discounts. As these customers may easily move their shopping experience to another supermarket if our prices are more expensive, management could consider creating value on top of competitive prices. Value can be created through excellent customer service, point reward programs, or have an essential item always priced lower than competitors.

